version: 0.2
phases:
  pre_build:
    commands:
      - echo Loguearse dentro de Amazon ECR...
      - aws ecr get-login-password --region us-east-2 | docker login --username AWS --password-stdin 781000631387.dkr.ecr.us-east-2.amazonaws.com
  build:
    commands:
      - echo Inicio compilación en `date`
      - echo Construyendo imagen de docker...
      - docker build -t localhost_app_respository:latest .
      - echo Etiquetando imagen de docker...
      - docker tag localhost_app_respository:latest 781000631387.dkr.ecr.us-east-2.amazonaws.com/localhost_app_respository:latest
  post_build:
    commands:
      - echo Creación de imagen completada en `date`
      - echo Enviar  imagen al repositorio de AWS...
      - docker push 781000631387.dkr.ecr.us-east-2.amazonaws.com/localhost_app_respository:latest
      - echo Escribiendo el archivo de definición de la imagen...
      - printf '[{"name":"Container-app-python","imageUri":"781000631387.dkr.ecr.us-east-2.amazonaws.com/localhost_app_respository:latest"}]' > imagedefinitions.json
      - printf '{"ImageURI":"781000631387.dkr.ecr.us-east-2.amazonaws.com/localhost_app_respository:latest"}' > imageLocalhostDevopsDetail.json
      - cat imagedefinitions.json
artifacts:
  files:
    - taskdef.json
    - imagedefinitions.json
    - imageLocalhostDevopsDetail.json
  name: BuildArtifact